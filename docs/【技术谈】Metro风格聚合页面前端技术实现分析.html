
<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->

<html lang="zh-CN">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>【技术谈】Metro风格聚合页面前端技术实现分析 | Titan</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://qqfe.org/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://qqfe.org/wp-content/themes/qfe/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Titan &raquo; Feed" href="http://qqfe.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="Titan &raquo; 评论 Feed" href="http://qqfe.org/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Titan &raquo; 【技术谈】Metro风格聚合页面前端技术实现分析 评论 Feed" href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91metro%e9%a3%8e%e6%a0%bc%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/feed/" />
<link rel='stylesheet' id='twentytwelve-style-css'  href='http://mat1.gtimg.com/joke/tomiezhang/qqfeStyle.css?ver=3.5' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://qqfe.org/wp-content/themes/qfe/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://qqfe.org/wp-includes/js/comment-reply.min.js?ver=3.5'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://qqfe.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://qqfe.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='【我是翻客】Case Study: Find Your Way to Oz' href='http://qqfe.org/2013/04/%e3%80%90%e6%88%91%e6%98%af%e7%bf%bb%e5%ae%a2%e3%80%91case-study-find-your-way-to-oz/' />
<meta name="generator" content="WordPress 3.5" />
<link rel='canonical' href='http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91metro%e9%a3%8e%e6%a0%bc%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/' />
<link rel='shortlink' href='http://qqfe.org/?p=277' />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.5" />
</head>

<body class="single single-post postid-277 single-format-standard custom-background-empty">
 <!--[if lte IE 8]>
		<div class="ifie" id="ifie">
        	建议您使用 <a target="_blank" title="下载Chrome" href="http://www.google.com/chrome/">Google Chrome</a>浏览器访问本站<a href="javascript:void(0)">关闭</a>
        </div>
<script type="text/javascript">	
(function() {
	var ifie=document.getElementById("ifie");
    var ifieBtn=ifie.getElementsByTagName("a")[1];
	ifieBtn.onclick= function(){
		ifie.style.display="none";
	}
	var oclosed;
	var oms=0;
	function oRun(){
		oclosed = setTimeout(oRun,1000);
		oms++;
		if(oms==7){
			clearTimeout(oclosed);
			ifie.style.display="none";
		}
	}
	oRun()
})()
</script>
	 <![endif]-->
<header id="masthead" class="site-header" role="banner">
		<hgroup>
        	<div class="header-search"><form role="search" method="get" id="searchform" action="http://qqfe.org/" >
	<div><label class="screen-reader-text" for="s">搜索：</label>
	<input type="text" value="" name="s" id="s" />
	<input type="submit" id="searchsubmit" value="搜索" />
	</div>
	</form></div>
			<h1 class="site-title" style="height:1px;padding:20px 0 60px 0;line-height:80px;"></h1>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h3 class="menu-toggle">菜单</h3>
			<a class="assistive-text" href="#content" title="跳至内容">跳至内容</a>
			<div class="menu-qqfe-container"><ul id="menu-qqfe" class="nav-menu"><li id="menu-item-100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-100"><a href="http://qqfe.org/">首页</a></li>
<li id="menu-item-78" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-78"><a href="http://qqfe.org/category/frontend/">前端技术</a></li>
<li id="menu-item-79" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-79"><a href="http://qqfe.org/category/product/">产品设计</a></li>
<li id="menu-item-80" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-80"><a href="http://qqfe.org/category/experience/">用户体验</a></li>
<li id="menu-item-82" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-82"><a href="http://qqfe.org/category/team/">团队活动</a></li>
<li id="menu-item-81" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81"><a href="http://qqfe.org/category/lab/">实验室</a></li>
</ul></div>		</nav><!-- #site-navigation -->

		    
	</header><!-- #masthead -->
<div id="page" class="hfeed site">
	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

			
					<article id="post-277" class="post-277 post type-post status-publish format-standard hentry category-frontend tag-javascript">
				<header class="entry-header">
									<h1 class="entry-title">【技术谈】Metro风格聚合页面前端技术实现分析</h1>
						 <time class="entry-date" datetime="2013-04-22T04:42:25+00:00">04/22/2013</time>             
		</header><!-- .entry-header -->

				<div class="entry-content">
			<p>最近一直在做一个新闻类的产品，产品的理念要突出每天发生新闻的热度，需要以标签纬度聚合腾讯网的新闻内容。类似与虎嗅标签的重要TAG列表，然后在网友们面前突出TAG的热度，吸引潜在用户订阅，点击TAG，进入TAG类的新闻。对国内外的聚合页产品进行了分析和比较，发现网易的一款叫“聚合阅读”的聚合产品很有意思，遂对其前端实现发生了兴趣，点击<a href="http://news.tag.163.com" target="_blank">news.tag.163.com</a>，打开后，满屏的方格新闻块儿铺满屏幕，浓厚的Metro风格。在高级浏览器下，刷新会有整个方格平滑重排定位的效果，点击下方按钮也会有左右平滑切换的效果。我估计身为对UI层比较敏感的前端的同学条件反射式的想会去分析这个案例是如何实现的。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/1/" rel="attachment wp-att-278"><img class="alignnone size-medium wp-image-278" alt="1" src="http://qqfe.org/wp-content/uploads/2013/04/1-300x193.png" width="300" height="193" /></a>   <a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/2/" rel="attachment wp-att-279"><img class="alignnone size-medium wp-image-279" alt="2" src="http://qqfe.org/wp-content/uploads/2013/04/2-300x193.png" width="300" height="193" /></a></p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/3/" rel="attachment wp-att-280"><img class="alignnone size-medium wp-image-280" alt="3" src="http://qqfe.org/wp-content/uploads/2013/04/3-300x193.png" width="300" height="193" />   </a><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/4/" rel="attachment wp-att-281"><img class="alignnone size-medium wp-image-281" alt="4" src="http://qqfe.org/wp-content/uploads/2013/04/4-300x193.png" width="300" height="193" /></a></p>
<p><span id="more-277"></span></p>
<p>从产品角度上看，本例子可以说是典型的门户型网络产品。强调新闻时效性，热度，信息展示。并以一种全新的方式去展示新闻的内容的聚合。</p>
<p>从前端技术角度上，本例子也可列为典型的webApp技术实现案例，涉及的技术实现包括HTML5, CSS3 , JSONP, JS Template。粗略的分析一下，需要前端开发同学实现的需求有：</p>
<ul>
<li>当用户刷新页面，切换到不同天数选项对应方格填充的数据需要改变或者重新定位</li>
<li>页面一共放置37个方格新闻块儿，方格儿排序规则如下：方格块儿分左右两测，每列分三行，左侧左下角内部需要分成4列，第一列三行，第二列一行，第三列三行，第四列两行。右侧分三行，每行也依照左侧左下角的逻辑进行分块。需要注意的是，以行为单位的大块儿有明显的颜色区分</li>
<li>高级浏览器上，用户触发鼠标事件，转场切换需要有缓动，定位重排效果。</li>
<li>能适应不同的PC机不同浏览器窗口的分辨率，适配不同的移动设备，包括手机，平板。需要能运行在不同分辨率的移动设备上。</li>
<li>与后端定制数据接口。展示出新闻大标题，副标题，链接。</li>
</ul>
<p>需求理解完之后，下面就要考虑实现了。</p>
<p>先做需求2：</p>
<p>因为做过一段时间重构，所以拿到这个设计稿，脑子里第一反是用绝对定位去搞定这个满是方格的PSD稿子了。以此为思路，做出demo。但是改变浏览器的窗口大小之后，方格会浏览器窗口截断，高度也延伸不到底部，这样就铺满不了整个窗口，因为绝对定位的定宽定高，被截断是必然。那么换一个方法，每个CSS方格的width, height, top,left 均设置为百分数，来达到此种效果，但CSS百分数虽然是参照屏幕的宽度进行计算，还是不太精确，会出现定位不准问题，如要做如此多的方格铺排，自然是不行。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/5/" rel="attachment wp-att-282"><img class="alignnone size-medium wp-image-282" alt="5" src="http://qqfe.org/wp-content/uploads/2013/04/5-300x292.png" width="300" height="292" /></a></p>
<p>不过，思路是有了，把用百分数计算换成获取到客户端clientWidth, clientHeight,然后把宽高度动态分配到37个方格新闻块儿里。当客户端浏览器窗口大小改变之后，重复以上动作，方格铺排完成。</p>
<p>用JSON来表示方格的排列逻辑再好不过。具体为window.tagConfig.pageLayout,上代码</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/6/" rel="attachment wp-att-283"><img class="alignnone size-full wp-image-283" alt="6" src="http://qqfe.org/wp-content/uploads/2013/04/6.png" width="542" height="953" /></a></p>
<p>方格按层级包含逻辑，从最外层的pageLayout到最底层cols包含的rows，一级一级描述方格的包含关系。数字100表示铺满屏幕，45，55表示本列所占屏幕的百分比。Random设置是否随机铺排。下面是第一列的铺排逻辑代码。可以对照右侧图进行分析</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/7/" rel="attachment wp-att-284"><img class="alignnone size-medium wp-image-284" alt="7" src="http://qqfe.org/wp-content/uploads/2013/04/7-180x300.png" width="180" height="300" /></a><img alt="8" src="http://qqfe.org/wp-content/uploads/2013/04/8-236x300.png" width="236" height="300" /></p>
<p>数据准备好之后，调用对应的函数进行铺排，下面的AutoLoader是一个数组操作类，用来数组保存内部函数_getGrids执行后返回的结果。自己封装了get, regenerate操作。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/9/" rel="attachment wp-att-288"><img class="alignnone size-full wp-image-288" alt="9" src="http://qqfe.org/wp-content/uploads/2013/04/9.png" width="506" height="70" /></a></p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/10/" rel="attachment wp-att-289"><img class="alignnone size-full wp-image-289" alt="10" src="http://qqfe.org/wp-content/uploads/2013/04/10.png" width="738" height="419" /></a></p>
<p>&#8212;&#8212;&#8212;&#8212;&#8211;此处为预设点1&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>上面代码可直观的看出，_cuteGrid函数负责迭代方格新闻块对象，赋值每个子方格新闻块儿的属性。具体为若方格新闻块存e.row , e.cols等数据信息，_cuteGrid就递归自身，计算网格布局。否则就附加颜色，字体，字体颜色，背景颜色。</p>
<p>关于如何计算布局，理解一下_cuteGrid函数就可以。传入全部布局信息pageLayout对象，以及控制布局callback。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/11/" rel="attachment wp-att-290"><img class="alignnone size-full wp-image-290" alt="11" src="http://qqfe.org/wp-content/uploads/2013/04/11.png" width="725" height="973" /></a></p>
<p>例如，初次传入的e为window.tagConfig.pageLayout，进入函数后，程式会初次判断e对象是否存在rows属性，显然第一层之存在cols属性并不存在rows属性。通过三目运算符赋值n,r对应属性（也可以对比一下存在rows属性情况n,r赋值，两者完全相反）</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/11-2/" rel="attachment wp-att-291"><img class="alignnone size-full wp-image-291" alt="11" src="http://qqfe.org/wp-content/uploads/2013/04/111.png" width="254" height="199" /></a></p>
<p>以下为_cuteGrid函数最核心的执行部分,使用数组方法forEach,或者randomEach，</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/12/" rel="attachment wp-att-292"><img class="alignnone size-full wp-image-292" alt="12" src="http://qqfe.org/wp-content/uploads/2013/04/12.png" width="449" height="79" /></a></p>
<p>程序执行到此e[n.name]为e.cols，然后数组附加a函数进行迭代新闻块儿定位。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/13/" rel="attachment wp-att-293"><img class="alignnone size-full wp-image-293" alt="13" src="http://qqfe.org/wp-content/uploads/2013/04/13.png" width="309" height="434" /></a></p>
<p>关于a函数，看下图，现在传入的a参数就是我们通过e[n.name].forEach(a)传入的数组元素了，第一此传入则为cols的第一列数据。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/14/" rel="attachment wp-att-294"><img class="alignnone size-full wp-image-294" alt="14" src="http://qqfe.org/wp-content/uploads/2013/04/14.png" width="674" height="468" /></a></p>
<p>执行到下面代码片段时候, l通过赋值a[r.name].length就获取到其内部rows数组长度，</p>
<p>然后通过对比u===o？是否相等，u开始为0，判断u是否等于e.cols.length(2)是否相当，来检测此次铺排的次数是否已到，因为是第一次，所以f = Math.floor( a[n.measure] * e[n.measure] / 100 ),</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/15/" rel="attachment wp-att-295"><img class="alignnone size-full wp-image-295" alt="15" src="http://qqfe.org/wp-content/uploads/2013/04/15.png" width="686" height="156" /></a></p>
<p>解释一下，a[n.measure]=45 (本次传入数组元素的模拟width数值),  e[n.measure]=100（本次传入数组元素的夫级元素的模拟width数组），这些数值均写在预设置的json数据中。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/16/" rel="attachment wp-att-296"><img class="alignnone size-full wp-image-296" alt="16" src="http://qqfe.org/wp-content/uploads/2013/04/16.png" width="271" height="243" /></a></p>
<p>此时f=45, 下面通过判断a.random是否为!1,通过调用forEach(h),randomEach(h)两个方法调用内部定位和颜色赋值函数h，来继续迭代子元素。</p>
<p>h函数负责给一个新建对象a, 也就是当前子元素rows, 赋值定位信息的函数。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/17/" rel="attachment wp-att-297"><img class="alignnone size-full wp-image-297" alt="17" src="http://qqfe.org/wp-content/uploads/2013/04/17.png" width="684" height="271" /></a></p>
<p>让面的代码可以理解为</p>
<pre class="brush: jscript; title: ; notranslate" title="">
a.left=0+e.left，
a.top=0+e.top,
a.width=45,
a.height=1 ,
a.colorPattern=’#ce5f52’ // 颜色信息在调用_getGrids已经设置
</pre>
<p>当遇到t(a) 然后再次调用下面的function(e){ ….. } 内部的函数进行递归。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/20/" rel="attachment wp-att-298"><img class="alignnone size-full wp-image-298" alt="20" src="http://qqfe.org/wp-content/uploads/2013/04/20.png" width="762" height="336" /></a></p>
<p>文章您读到这里，恭喜，程序就已经成功的绘制了下面的一个最大的蓝色方框。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/21/" rel="attachment wp-att-299"><img class="alignnone size-full wp-image-299" alt="21" src="http://qqfe.org/wp-content/uploads/2013/04/21.png" width="188" height="236" /></a> <a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/22/" rel="attachment wp-att-300"><img class="alignnone size-thumbnail wp-image-300" alt="22" src="http://qqfe.org/wp-content/uploads/2013/04/22-150x139.png" width="150" height="139" /></a></p>
<p>如果想再次绘制里面的一个很多小方框，</p>
<p>原理就是再次调用_cutGrid函数。对于本文，您的目光就再次返回到文章的预设点1，然后回到这里，蓝色方框里就绘制好了另外的蓝色方框了。循环往复，最后整个页面的布局信息就完全OK了。</p>
<p>绘制完成所有信息之后，在控制台里打印出t,就可以直观的看出37个新闻布局块儿的属性。这些结果被保存在名为t的数组里。由函数_getGrids返回。并由AutoLoader类进行初始化操作。保存在AutoLoader对象的pool的属性里。然后统一进行管理。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/23/" rel="attachment wp-att-301"><img class="alignnone size-full wp-image-301" alt="23" src="http://qqfe.org/wp-content/uploads/2013/04/23.png" width="642" height="341" /></a></p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/24/" rel="attachment wp-att-302"><img class="alignnone size-full wp-image-302" alt="24" src="http://qqfe.org/wp-content/uploads/2013/04/24.png" width="511" height="133" /></a></p>
<p>getTagData原理与_getGrids类型，通过迭代与后端定制json数据接口。也保存在初始化过后的AutoLoader对象的pool的属性里。随后就可以方便的与新闻布局块儿进行迭代计算，把数据信息动态的填充到37个布局信息块儿中。</p>
<p>到此，需求2实现完毕</p>
<p>再看需求1和3。当用户刷新页面，点击刷行按钮，点击下方切换按钮天数，37个方格块儿重新定位，在支持CSS3的浏览器上，37方格块儿转场切换需要有缓动进入进出的效果，以及归位重排效果。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/25/" rel="attachment wp-att-303"><img class="alignnone size-medium wp-image-303" alt="25" src="http://qqfe.org/wp-content/uploads/2013/04/25-300x193.png" width="300" height="193" /></a> <a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/26/" rel="attachment wp-att-304"><img class="alignnone size-medium wp-image-304" alt="26" src="http://qqfe.org/wp-content/uploads/2013/04/26-300x193.png" width="300" height="193" /></a></p>
<p>为实现这两个关键的交互效果 ,</p>
<p>这里把方格中一二级标题填充HTML代码，转场缓动进入进出的css3语法逻辑分离出来，使用micro template(为追求模版引擎速度推荐使用artTemplate ) 编写其对应的模版规则。</p>
<p>如下，这样做，使得逻辑更加清晰，节省代码量，方便代码的管理与后期维护升级。</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/27/" rel="attachment wp-att-305"><img class="alignnone size-full wp-image-305" alt="27" src="http://qqfe.org/wp-content/uploads/2013/04/27.png" width="540" height="280" /></a></p>
<p>(一二级标题填充模版)</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/28/" rel="attachment wp-att-306"><img class="alignnone size-full wp-image-306" alt="28" src="http://qqfe.org/wp-content/uploads/2013/04/28.png" width="524" height="720" /></a></p>
<p>（转场进入进出模版Prefix为["-moz-", "-webkit-", "-o-", "-ms-", ""]的缩略简写，offset滑动多少距离）</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/29/" rel="attachment wp-att-307"><img class="alignnone size-medium wp-image-307" alt="29" src="http://qqfe.org/wp-content/uploads/2013/04/29-300x193.png" width="300" height="193" /></a></p>
<p>这里分析一下转场动作，本项目两页之间的切换为整屏幕切换。因为先前37个新闻布局块儿铺排已经完成，所以在转场的时候，只需在每一个新闻块儿的tag设置translateX属性，也就是设置offset为window.clientWidth。比如页面在第一屏切换到第二屏幕时，所有方格新闻块儿使用transform:translateX(offset) 进行位移，因为第一屏中所有新闻方格已经有各自的top,left定位值，再加上各自transform的translateX(offset)值。就可以完成位移操作。若实现缓动效果，设置transition-property:left,top两个属性值，在transition,animation属性上设置duration运动持续时间就行。</p>
<p>然后是点击刷新按钮，打乱当前所有新闻块儿，产生定位重排的效果。如图</p>
<p><a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e7%bd%91%e6%98%93%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/attachment/30/" rel="attachment wp-att-308"><img class="alignnone size-medium wp-image-308" alt="30" src="http://qqfe.org/wp-content/uploads/2013/04/30-300x193.png" width="300" height="193" /></a></p>
<p>这个实现原理简单，重新定位当前屏幕所有的新闻块儿，重新获取当前屏JSON数据，然后参照需求2重新进行37个新闻块儿的定位计算，完成后，统一插入到当前屏幕中央区域。缓动归位的效果的话，同样，设置transition-property:left,top布局属性，transition,animation设置duration动画持续运动持续时间的属性。达到此效果。</p>
<p>到这里，就剩下需求4,5了，关于需求5：能适应不同的PC机不同浏览器窗口的分辨率，适配不同的移动设备，包括手机，平板。需要能运行在不同分辨率的移动设备上。</p>
<p>原理上，只要在用户改变浏览器窗口大小的时候，中间方格块儿能够铺满任意大小窗口的浏览器，那么各种设备的分辨率，无论是平板，各种分辨率的手机都可以完全兼容。原因是37个新闻布局块儿是布局信息是根据当前屏幕的clientWidth,clientHeight进行计算的。</p>
<p>所以，有当window有onresized动作触发的情况下，再次按照需求2，重新按照当前浏览器窗口大小迭代计算37个新闻布局块儿的布局信息，填充整个屏幕，再把数据信息动态的填充到37个布局信息块儿中。从此，各种分辨率设备完美兼容</p>
<p>项目分析总结：</p>
<ol>
<li>在项目中可以采取针对不同浏览器开发的思路，在支持CSS3的浏览器上多做尝试，不支持的做降级处理，拥抱webapp化。</li>
<li>webApp时代对前端的技能要求越来越高。开发者针对高级动画需求的实现需要有更加严谨的逻辑和扎实的编码能力。</li>
<li>多分析一些经典项目源代码，譬如github上的源代码，找些实际项目多练，才是技术进步的阶梯。</li>
</ol>
<p>最终的实现demo在这里：<a href="http://mat1.gtimg.com/joke/js/boqiu/juhe.7z" target="_blank">http://mat1.gtimg.com/joke/js/boqiu/juhe.7z</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
        	<div class="avatar">
            	<img alt='' src='http://1.gravatar.com/avatar/702a65240d1e187a8ae98c22ff0a54e1?s=36&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D36&amp;r=G' class='avatar avatar-36 photo' height='36' width='36' />            </div>
            <div class="description">
            	<p>分类： <a href="http://qqfe.org/category/frontend/" title="查看 前端技术 中的全部文章" rel="category tag">前端技术</a>				<i class="dot">·</i><span class="comments-link">
					<a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91metro%e9%a3%8e%e6%a0%bc%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/#respond" title="《【技术谈】Metro风格聚合页面前端技术实现分析》上的评论"><span class="leave-reply">发表回复</span></a>				</span><!-- .comments-link --><i class='dot'>·</i><span class='views'>115 Views</span>			</p>
                <p><span class="by-author">by：<a class="url fn n" href="http://qqfe.org/author/boqiu/" title="View all posts by boqiu" rel="author">boqiu</a></span></p>
            </div>
			
             
			
            
           		</footer><!-- .entry-meta -->
	</article><!-- #post -->
				<nav class="nav-single">
					<h3 class="assistive-text">文章导航</h3>
					<span class="nav-previous"><a href="http://qqfe.org/2013/04/%e3%80%90%e6%88%91%e6%98%af%e7%bf%bb%e5%ae%a2%e3%80%91case-study-find-your-way-to-oz/" rel="prev"><span class="meta-nav">&larr;</span> 【我是翻客】Case Study: Find Your Way to Oz</a></span>
					<span class="nav-next"></span>
				</nav><!-- .nav-single -->
                   
                  				
<div id="comments" class="comments-area">

	
	
									<div id="respond">
				<h3 id="reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91metro%e9%a3%8e%e6%a0%bc%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/#respond" style="display:none;">取消回复</a></small></h3>
									<form action="http://qqfe.org/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes">电子邮件地址不会被公开。 必填项已用 <span class="required">*</span> 标注</p>							<p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">站点</label><input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">评论</label><textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">您可以使用这些 <abbr title="HyperText Markup Language">HTML</abbr> 标签和属性： <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="发表评论" />
							<input type='hidden' name='comment_post_ID' value='277' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
											</form>
							</div><!-- #respond -->
						
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->

			<div id="secondary" class="widget-area" role="complementary">
			<aside id="sidebar-about" class="widget widget_categories"><h3 class="widget-title">关于我们</h3>	
			<p>
			 欢迎光临Titan，我们是腾讯网前端团队，主要负责腾讯旗下门户网站(QQ.com)以及相关产品的前端部分... <a href="http://qqfe.org/about/">[更多]</a>
			</p>	 
		</aside>
			<aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">分类目录</h3>		<ul>
	<li class="cat-item cat-item-9"><a href="http://qqfe.org/category/product/" title="查看 产品设计 下的所有文章">产品设计</a> (1)
</li>
	<li class="cat-item cat-item-1"><a href="http://qqfe.org/category/frontend/" title="查看 前端技术 下的所有文章">前端技术</a> (6)
</li>
		</ul>
</aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">近期文章</h3>		<ul>
					<li>
				<a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91metro%e9%a3%8e%e6%a0%bc%e8%81%9a%e5%90%88%e9%a1%b5%e9%9d%a2%e5%89%8d%e7%ab%af%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/" title="【技术谈】Metro风格聚合页面前端技术实现分析">【技术谈】Metro风格聚合页面前端技术实现分析</a>
						</li>
					<li>
				<a href="http://qqfe.org/2013/04/%e3%80%90%e6%88%91%e6%98%af%e7%bf%bb%e5%ae%a2%e3%80%91case-study-find-your-way-to-oz/" title="【我是翻客】Case Study: Find Your Way to Oz">【我是翻客】Case Study: Find Your Way to Oz</a>
						</li>
					<li>
				<a href="http://qqfe.org/2013/04/%e3%80%90%e6%88%91%e6%98%af%e7%bf%bb%e5%ae%a2%e3%80%91%e5%a6%82%e4%bd%95%e8%ae%a9%e4%bd%a0%e7%9a%84%e7%bd%91%e7%ab%99%e5%9c%a8%e7%a7%bb%e5%8a%a8%e8%ae%be%e5%a4%87%e4%b8%8a%e6%9b%b4%e5%bf%ab/" title="【我是翻客】如何让你的网站在移动设备上更快">【我是翻客】如何让你的网站在移动设备上更快</a>
						</li>
					<li>
				<a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91%e5%b0%91%e4%be%bf%e6%98%af%e5%a4%9a/" title="【技术谈】少便是多">【技术谈】少便是多</a>
						</li>
					<li>
				<a href="http://qqfe.org/2013/04/%e3%80%90%e6%8a%80%e6%9c%af%e8%b0%88%e3%80%91ipad%e4%b8%8a%e7%9a%84%e9%98%85%e8%af%bb%e4%bd%93%e9%aa%8c/" title="【技术谈】ipad上的阅读体验">【技术谈】ipad上的阅读体验</a>
						</li>
				</ul>
		</aside><aside id="recent-comments-2" class="widget widget_recent_comments"><h3 class="widget-title">近期评论</h3><ul id="recentcomments"><li class="recentcomments">bankie 发表在《<a href="http://qqfe.org/about/comment-page-1/#comment-13">关于我们</a>》</li><li class="recentcomments">tomiezhang 发表在《<a href="http://qqfe.org/2013/04/%e3%80%90%e6%88%91%e6%98%af%e7%bf%bb%e5%ae%a2%e3%80%91css%e4%bc%98%e5%8c%96%e7%ac%94%e8%ae%b0-%e5%88%86%e6%9e%90%e7%9a%84%e4%b9%90%e8%b6%a3%e4%b8%8e%e6%94%b6%e8%8e%b7/comment-page-1/#comment-12">【我是翻客】CSS优化笔记&#8211;分析的乐趣与收获</a>》</li><li class="recentcomments">闫森 发表在《<a href="http://qqfe.org/about/comment-page-1/#comment-11">关于我们</a>》</li><li class="recentcomments">咖啡蓝调 发表在《<a href="http://qqfe.org/2013/04/%e3%80%90%e6%88%91%e6%98%af%e7%bf%bb%e5%ae%a2%e3%80%91css%e4%bc%98%e5%8c%96%e7%ac%94%e8%ae%b0-%e5%88%86%e6%9e%90%e7%9a%84%e4%b9%90%e8%b6%a3%e4%b8%8e%e6%94%b6%e8%8e%b7/comment-page-1/#comment-10">【我是翻客】CSS优化笔记&#8211;分析的乐趣与收获</a>》</li><li class="recentcomments">rockywen 发表在《<a href="http://qqfe.org/about/comment-page-1/#comment-9">关于我们</a>》</li></ul></aside><aside id="linkcat-2" class="widget widget_links"><h3 class="widget-title">友情连接</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://tomiedev.sinaapp.com/">T-NinJa</a></li>
<li><a href="http://www.blueidea.com/">蓝色理想</a></li>

	</ul>
</aside>
		</div><!-- #secondary -->
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
            Copyright ©  2012++ Tencent Website Front-end Team. Powered By WordPress.
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='http://mat1.gtimg.com/joke/tomiezhang/shCore.js?ver=3.0.83c'></script>
<script type='text/javascript' src='http://mat1.gtimg.com/joke/tomiezhang/shBrushJScript.js?ver=3.0.83c'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://qqfe.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://qqfe.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeMidnight.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '帮助';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = '无法找到Brush：';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush不能设置 html-script选项';
	SyntaxHighlighter.defaults['auto-links'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script>
/**
 * navigation.js
 *
 * Handles toggling the navigation menu for small screens.
 */
( function() {
	var nav = document.getElementById( 'site-navigation' ), button, menu;
	if ( ! nav )
		return;
	button = nav.getElementsByTagName( 'h3' )[0];
	menu   = nav.getElementsByTagName( 'ul' )[0];
	if ( ! button )
		return;

	// Hide button if menu is missing or empty.
	if ( ! menu || ! menu.childNodes.length ) {
		button.style.display = 'none';
		return;
	}

	button.onclick = function() {
		if ( -1 == menu.className.indexOf( 'nav-menu' ) )
			menu.className = 'nav-menu';

		if ( -1 != button.className.indexOf( 'toggled-on' ) ) {
			button.className = button.className.replace( ' toggled-on', '' );
			menu.className = menu.className.replace( ' toggled-on', '' );
		} else {
			button.className += ' toggled-on';
			menu.className += ' toggled-on';
		}
	};
} )();
</script>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=23912633" charset="UTF-8"></script>
</body>
</html>